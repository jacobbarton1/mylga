{% extends "base.html" %}

{% block content %}
<div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
  <div>
    <h2 class="mb-0">All defect reports</h2>
    <p class="text-muted mb-0">Includes resolved and closed items.</p>
  </div>
  <div class="d-flex flex-wrap gap-2">
    <a href="{% url 'fleet:defect_create' %}" class="btn btn-warning">Create defect</a>
    <a href="{% url 'fleet:maintenance_create' %}" class="btn btn-outline-success">Add maintenance</a>
  </div>
</div>

{% if defects %}
<div class="table-responsive">
  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>Date reported</th>
        <th>Vehicle</th>
        <th>Severity</th>
        <th>Status</th>
        <th>Reported by</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for defect in defects %}
      <tr>
        <td>{{ defect.reported_at|date:"Y-m-d H:i" }}</td>
        <td>Unit {{ defect.vehicle.unit_number|floatformat:"0" }} â€” {{ defect.vehicle.registration }}</td>
        <td>{{ defect.get_severity_display }}</td>
        <td>{{ defect.get_status_display }}</td>
        <td>{{ defect.reported_by.get_full_name|default:defect.reported_by|default:"Unknown" }}</td>
        <td class="text-end">
          <a class="btn btn-outline-secondary btn-sm" href="{% url 'fleet:defect_detail' defect.pk %}">View</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<nav class="mt-3" aria-label="All defects pagination">
  <ul class="pagination">
    {% if page_obj.has_previous %}
    <li class="page-item">
      <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
    </li>
    {% else %}
    <li class="page-item disabled"><span class="page-link">Previous</span></li>
    {% endif %}

    <li class="page-item disabled">
      <span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    </li>

    {% if page_obj.has_next %}
    <li class="page-item">
      <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
    </li>
    {% else %}
    <li class="page-item disabled"><span class="page-link">Next</span></li>
    {% endif %}
  </ul>
</nav>
{% else %}
<p class="text-muted">No defect reports recorded yet.</p>
{% endif %}
{% endblock %}
