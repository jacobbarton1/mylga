{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Defect for Unit {{ defect.vehicle.unit_number|floatformat:"0" }}</h2>
  <div>
    <a href="{% url 'fleet:defect_update' defect.pk %}" class="btn btn-warning btn-sm me-2">Edit defect</a>
    <a href="{% url 'fleet:vehicle_detail' defect.vehicle.pk %}" class="btn btn-outline-secondary btn-sm">Back to vehicle</a>
  </div>
</div>

<div class="card mb-4">
  <div class="card-body">
    <dl class="row">
      <dt class="col-sm-3">Severity</dt>
      <dd class="col-sm-9">{{ defect.get_severity_display }}</dd>
      <dt class="col-sm-3">Status</dt>
      <dd class="col-sm-9">{{ defect.get_status_display }}</dd>
      <dt class="col-sm-3">Reported by</dt>
      <dd class="col-sm-9">{{ defect.reported_by.get_full_name|default:defect.reported_by|default:"Unknown" }}</dd>
      <dt class="col-sm-3">Reported at</dt>
      <dd class="col-sm-9">{{ defect.reported_at|date:"Y-m-d H:i" }}</dd>
      <dt class="col-sm-3">Description</dt>
      <dd class="col-sm-9">{{ defect.description }}</dd>
      <dt class="col-sm-3">Workshop notes</dt>
      <dd class="col-sm-9">{{ defect.workshop_notes|default:"—" }}</dd>
    </dl>
  </div>
</div>

<h5>Related maintenance records</h5>
{% with records=defect.maintenance_records.all %}
  {% if records %}
  <ul class="list-group">
    {% for record in records %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <div>
        <div class="fw-bold">{{ record.date|date:"Y-m-d" }} — {{ record.description }}</div>
        <div class="small text-muted">Submitted by {{ record.submitted_by.get_full_name|default:record.submitted_by|default:"System" }}</div>
      </div>
      <a class="btn btn-sm btn-outline-primary" href="{% url 'fleet:maintenance_detail' record.pk %}">View record</a>
    </li>
    {% endfor %}
  </ul>
  {% else %}
  <p class="text-muted">No related maintenance records yet.</p>
  {% endif %}
{% endwith %}
{% endblock %}
