{% extends "base.html" %}

{% block content %}
<div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
  <div>
    <h2 class="mb-0">Maintenance records</h2>
    <p class="text-muted mb-0">Most recent entries first.</p>
  </div>
  <div class="d-flex flex-wrap gap-2">
    <a href="{% url 'fleet:maintenance_create' %}" class="btn btn-success">Add maintenance</a>
    <a href="{% url 'fleet:vehicle_list' %}" class="btn btn-outline-primary">Manage vehicles</a>
  </div>
</div>

{% if records %}
<div class="table-responsive">
  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>Date</th>
        <th>Vehicle</th>
        <th>Description</th>
        <th>Linked defect</th>
        <th>Submitted by</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for record in records %}
      <tr>
        <td>{{ record.date|date:"Y-m-d" }}</td>
        <td>Unit {{ record.vehicle.unit_number|floatformat:"0" }} â€” {{ record.vehicle.registration }}</td>
        <td>{{ record.description }}</td>
        <td>
          {% if record.defect_report %}
            <a href="{% url 'fleet:defect_detail' record.defect_report.pk %}">{{ record.defect_report.get_status_display }} defect</a>
          {% else %}
            <span class="text-muted">None</span>
          {% endif %}
        </td>
        <td>{{ record.submitted_by.get_full_name|default:record.submitted_by|default:"System" }}</td>
        <td class="text-end">
          <a class="btn btn-outline-secondary btn-sm" href="{% url 'fleet:maintenance_detail' record.pk %}">View</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<nav class="mt-3" aria-label="Maintenance pagination">
  <ul class="pagination">
    {% if page_obj.has_previous %}
    <li class="page-item">
      <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
    </li>
    {% else %}
    <li class="page-item disabled"><span class="page-link">Previous</span></li>
    {% endif %}

    <li class="page-item disabled">
      <span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    </li>

    {% if page_obj.has_next %}
    <li class="page-item">
      <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
    </li>
    {% else %}
    <li class="page-item disabled"><span class="page-link">Next</span></li>
    {% endif %}
  </ul>
</nav>
{% else %}
<p class="text-muted">No maintenance records have been submitted yet.</p>
{% endif %}
{% endblock %}
